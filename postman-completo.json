{
  "info": {
    "name": "DuocUC Fullstack3 - Microservicios Completo",
    "description": "Colección completa de endpoints para los microservicios ms-users y ms-laboratorios.\n\nMicroservicios:\n- ms-users (Puerto 8081): Gestión de usuarios y autenticación\n- ms-laboratorios (Puerto 8082): Gestión de laboratorios y asignaciones\n\nProyecto académico - DuocUC 2025",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "MS-USERS (Puerto 8081)",
      "item": [
        {
          "name": "Autenticación",
          "item": [
            {
              "name": "Login - Admin",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response contains user data\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('id');",
                      "    pm.expect(jsonData).to.have.property('email');",
                      "    pm.expect(jsonData).to.have.property('roles');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"email\": \"admin@hospital.cl\",\n  \"password\": \"admin123\"\n}"
                },
                "url": {
                  "raw": "{{base_url_users}}/api/users/login",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users",
                    "login"
                  ]
                },
                "description": "Login con usuario administrador del sistema"
              },
              "response": []
            },
            {
              "name": "Login - Doctor",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"email\": \"juan.perez@hospital.cl\",\n  \"password\": \"doctor123\"\n}"
                },
                "url": {
                  "raw": "{{base_url_users}}/api/users/login",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users",
                    "login"
                  ]
                },
                "description": "Login con usuario doctor"
              },
              "response": []
            },
            {
              "name": "Login - Lab Tech",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"email\": \"maria.gonzalez@hospital.cl\",\n  \"password\": \"lab123\"\n}"
                },
                "url": {
                  "raw": "{{base_url_users}}/api/users/login",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users",
                    "login"
                  ]
                },
                "description": "Login con usuario técnico de laboratorio"
              },
              "response": []
            },
            {
              "name": "Login - Credenciales Inválidas",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 401\", function () {",
                      "    pm.response.to.have.status(401);",
                      "});",
                      "",
                      "pm.test(\"Response contains error message\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.have.property('error');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"email\": \"usuario@noexiste.cl\",\n  \"password\": \"wrongpassword\"\n}"
                },
                "url": {
                  "raw": "{{base_url_users}}/api/users/login",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users",
                    "login"
                  ]
                },
                "description": "Prueba de login con credenciales incorrectas (debe fallar)"
              },
              "response": []
            }
          ],
          "description": "Endpoints de autenticación de usuarios"
        },
        {
          "name": "Gestión de Usuarios",
          "item": [
            {
              "name": "Listar Todos los Usuarios",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response is an array\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.be.an('array');",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{base_url_users}}/api/users",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users"
                  ]
                },
                "description": "Obtiene la lista completa de usuarios registrados"
              },
              "response": []
            },
            {
              "name": "Obtener Usuario por ID (Admin)",
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{base_url_users}}/api/users/1",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users",
                    "1"
                  ]
                },
                "description": "Obtiene los datos del usuario con ID 1 (Administrador)"
              },
              "response": []
            },
            {
              "name": "Obtener Usuario por Email",
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{base_url_users}}/api/users/email/admin@hospital.cl",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users",
                    "email",
                    "admin@hospital.cl"
                  ]
                },
                "description": "Busca un usuario por su dirección de email"
              },
              "response": []
            },
            {
              "name": "Crear Nuevo Usuario",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "if (pm.response.code === 201) {",
                      "    pm.test(\"Usuario creado exitosamente\", function () {",
                      "        pm.response.to.have.status(201);",
                      "    });",
                      "    ",
                      "    var jsonData = pm.response.json();",
                      "    pm.environment.set(\"new_user_id\", jsonData.id);",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"fullName\": \"Carlos Muñoz\",\n  \"email\": \"carlos.munoz@hospital.cl\",\n  \"passwordHash\": \"carlos123\",\n  \"enabled\": true\n}"
                },
                "url": {
                  "raw": "{{base_url_users}}/api/users",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users"
                  ]
                },
                "description": "Crea un nuevo usuario en el sistema"
              },
              "response": []
            },
            {
              "name": "Actualizar Usuario",
              "request": {
                "method": "PUT",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"fullName\": \"Dr. Juan Pérez Actualizado\",\n  \"email\": \"juan.perez@hospital.cl\",\n  \"passwordHash\": \"doctor123\",\n  \"enabled\": true\n}"
                },
                "url": {
                  "raw": "{{base_url_users}}/api/users/2",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users",
                    "2"
                  ]
                },
                "description": "Actualiza los datos de un usuario existente"
              },
              "response": []
            },
            {
              "name": "Toggle Enabled (Habilitar/Deshabilitar)",
              "request": {
                "method": "PATCH",
                "header": [],
                "url": {
                  "raw": "{{base_url_users}}/api/users/3/toggle-enabled",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users",
                    "3",
                    "toggle-enabled"
                  ]
                },
                "description": "Habilita o deshabilita un usuario (alterna el estado)"
              },
              "response": []
            },
            {
              "name": "Eliminar Usuario",
              "request": {
                "method": "DELETE",
                "header": [],
                "url": {
                  "raw": "{{base_url_users}}/api/users/4",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users",
                    "4"
                  ]
                },
                "description": "Elimina un usuario del sistema (cambiar ID según necesidad)"
              },
              "response": []
            }
          ],
          "description": "Operaciones CRUD para gestión de usuarios"
        },
        {
          "name": "Gestión de Roles",
          "item": [
            {
              "name": "Asignar Rol ADMIN",
              "request": {
                "method": "POST",
                "header": [],
                "url": {
                  "raw": "{{base_url_users}}/api/users/2/roles/ADMIN",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users",
                    "2",
                    "roles",
                    "ADMIN"
                  ]
                },
                "description": "Asigna el rol ADMIN al usuario con ID 2 (Dr. Juan Pérez)"
              },
              "response": []
            },
            {
              "name": "Asignar Rol DOCTOR",
              "request": {
                "method": "POST",
                "header": [],
                "url": {
                  "raw": "{{base_url_users}}/api/users/3/roles/DOCTOR",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users",
                    "3",
                    "roles",
                    "DOCTOR"
                  ]
                },
                "description": "Asigna el rol DOCTOR al usuario con ID 3"
              },
              "response": []
            },
            {
              "name": "Asignar Rol LAB_TECH",
              "request": {
                "method": "POST",
                "header": [],
                "url": {
                  "raw": "{{base_url_users}}/api/users/1/roles/LAB_TECH",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users",
                    "1",
                    "roles",
                    "LAB_TECH"
                  ]
                },
                "description": "Asigna el rol LAB_TECH al usuario con ID 1"
              },
              "response": []
            },
            {
              "name": "Remover Rol ADMIN",
              "request": {
                "method": "DELETE",
                "header": [],
                "url": {
                  "raw": "{{base_url_users}}/api/users/2/roles/ADMIN",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users",
                    "2",
                    "roles",
                    "ADMIN"
                  ]
                },
                "description": "Remueve el rol ADMIN del usuario con ID 2"
              },
              "response": []
            },
            {
              "name": "Remover Rol DOCTOR",
              "request": {
                "method": "DELETE",
                "header": [],
                "url": {
                  "raw": "{{base_url_users}}/api/users/3/roles/DOCTOR",
                  "host": [
                    "{{base_url_users}}"
                  ],
                  "path": [
                    "api",
                    "users",
                    "3",
                    "roles",
                    "DOCTOR"
                  ]
                },
                "description": "Remueve el rol DOCTOR del usuario con ID 3"
              },
              "response": []
            }
          ],
          "description": "Asignación y remoción de roles a usuarios"
        }
      ],
      "description": "Microservicio de gestión de usuarios y autenticación (Puerto 8081)",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    },
    {
      "name": "MS-LABORATORIOS (Puerto 8082)",
      "item": [
        {
          "name": "Gestión de Laboratorios",
          "item": [
            {
              "name": "Listar Todos los Laboratorios",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response is an array\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.be.an('array');",
                      "    pm.expect(jsonData.length).to.be.at.least(3);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{base_url_laboratorios}}/laboratorios",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "laboratorios"
                  ]
                },
                "description": "Obtiene la lista completa de laboratorios registrados"
              },
              "response": []
            },
            {
              "name": "Obtener Laboratorio por ID (Central)",
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{base_url_laboratorios}}/laboratorios/1",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "laboratorios",
                    "1"
                  ]
                },
                "description": "Obtiene los datos del Laboratorio Central (ID 1)"
              },
              "response": []
            },
            {
              "name": "Obtener Laboratorio por ID (San José)",
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{base_url_laboratorios}}/laboratorios/2",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "laboratorios",
                    "2"
                  ]
                },
                "description": "Obtiene los datos del Laboratorio San José (ID 2)"
              },
              "response": []
            },
            {
              "name": "Obtener Laboratorio por ID (La Serena)",
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{base_url_laboratorios}}/laboratorios/3",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "laboratorios",
                    "3"
                  ]
                },
                "description": "Obtiene los datos del Laboratorio La Serena (ID 3)"
              },
              "response": []
            },
            {
              "name": "Crear Nuevo Laboratorio",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "if (pm.response.code === 201) {",
                      "    pm.test(\"Laboratorio creado exitosamente\", function () {",
                      "        pm.response.to.have.status(201);",
                      "    });",
                      "    ",
                      "    var jsonData = pm.response.json();",
                      "    pm.environment.set(\"new_lab_id\", jsonData.id);",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"nombre\": \"Laboratorio Clínico Concepción\",\n  \"direccion\": \"Av. O'Higgins 123, Concepción\",\n  \"telefono\": \"+56941234567\"\n}"
                },
                "url": {
                  "raw": "{{base_url_laboratorios}}/laboratorios",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "laboratorios"
                  ]
                },
                "description": "Crea un nuevo laboratorio en el sistema"
              },
              "response": []
            },
            {
              "name": "Actualizar Laboratorio",
              "request": {
                "method": "PUT",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"nombre\": \"Laboratorio Central - Actualizado\",\n  \"direccion\": \"Av. Providencia 1234, Santiago (Nueva Dirección)\",\n  \"telefono\": \"+56912345999\"\n}"
                },
                "url": {
                  "raw": "{{base_url_laboratorios}}/laboratorios/1",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "laboratorios",
                    "1"
                  ]
                },
                "description": "Actualiza los datos de un laboratorio existente"
              },
              "response": []
            },
            {
              "name": "Eliminar Laboratorio",
              "request": {
                "method": "DELETE",
                "header": [],
                "url": {
                  "raw": "{{base_url_laboratorios}}/laboratorios/4",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "laboratorios",
                    "4"
                  ]
                },
                "description": "Elimina un laboratorio del sistema (cambiar ID según necesidad)"
              },
              "response": []
            }
          ],
          "description": "Operaciones CRUD para gestión de laboratorios"
        },
        {
          "name": "Gestión de Asignaciones",
          "item": [
            {
              "name": "Listar Todas las Asignaciones",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"Response is an array\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData).to.be.an('array');",
                      "    pm.expect(jsonData.length).to.be.at.least(5);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{base_url_laboratorios}}/asignaciones",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "asignaciones"
                  ]
                },
                "description": "Obtiene la lista completa de asignaciones de pacientes"
              },
              "response": []
            },
            {
              "name": "Obtener Asignación por ID (Juan Pérez)",
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{base_url_laboratorios}}/asignaciones/1",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "asignaciones",
                    "1"
                  ]
                },
                "description": "Obtiene la asignación del paciente Juan Pérez González"
              },
              "response": []
            },
            {
              "name": "Obtener Asignación por ID (María García)",
              "request": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{base_url_laboratorios}}/asignaciones/2",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "asignaciones",
                    "2"
                  ]
                },
                "description": "Obtiene la asignación de la paciente María García López"
              },
              "response": []
            },
            {
              "name": "Crear Nueva Asignación - Lab Central",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "if (pm.response.code === 201) {",
                      "    pm.test(\"Asignación creada exitosamente\", function () {",
                      "        pm.response.to.have.status(201);",
                      "    });",
                      "    ",
                      "    var jsonData = pm.response.json();",
                      "    pm.environment.set(\"new_asignacion_id\", jsonData.id);",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"paciente\": \"Roberto López Vega\",\n  \"fecha\": \"2025-11-15\",\n  \"laboratorio\": {\n    \"id\": 1\n  }\n}"
                },
                "url": {
                  "raw": "{{base_url_laboratorios}}/asignaciones",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "asignaciones"
                  ]
                },
                "description": "Crea una nueva asignación para el Laboratorio Central"
              },
              "response": []
            },
            {
              "name": "Crear Nueva Asignación - Lab San José",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"paciente\": \"Patricia Silva Morales\",\n  \"fecha\": \"2025-11-16\",\n  \"laboratorio\": {\n    \"id\": 2\n  }\n}"
                },
                "url": {
                  "raw": "{{base_url_laboratorios}}/asignaciones",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "asignaciones"
                  ]
                },
                "description": "Crea una nueva asignación para el Laboratorio San José"
              },
              "response": []
            },
            {
              "name": "Crear Nueva Asignación - Lab La Serena",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"paciente\": \"Andrés Fuentes Castro\",\n  \"fecha\": \"2025-11-17\",\n  \"laboratorio\": {\n    \"id\": 3\n  }\n}"
                },
                "url": {
                  "raw": "{{base_url_laboratorios}}/asignaciones",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "asignaciones"
                  ]
                },
                "description": "Crea una nueva asignación para el Laboratorio La Serena"
              },
              "response": []
            },
            {
              "name": "Actualizar Asignación",
              "request": {
                "method": "PUT",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"paciente\": \"Juan Pérez González (Actualizado)\",\n  \"fecha\": \"2025-11-20\",\n  \"laboratorio\": {\n    \"id\": 2\n  }\n}"
                },
                "url": {
                  "raw": "{{base_url_laboratorios}}/asignaciones/1",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "asignaciones",
                    "1"
                  ]
                },
                "description": "Actualiza los datos de una asignación existente"
              },
              "response": []
            },
            {
              "name": "Eliminar Asignación",
              "request": {
                "method": "DELETE",
                "header": [],
                "url": {
                  "raw": "{{base_url_laboratorios}}/asignaciones/6",
                  "host": [
                    "{{base_url_laboratorios}}"
                  ],
                  "path": [
                    "asignaciones",
                    "6"
                  ]
                },
                "description": "Elimina una asignación del sistema (cambiar ID según necesidad)"
              },
              "response": []
            }
          ],
          "description": "Operaciones CRUD para gestión de asignaciones de pacientes"
        }
      ],
      "description": "Microservicio de gestión de laboratorios y asignaciones (Puerto 8082)",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "base_url_users",
      "value": "http://localhost:8081",
      "type": "string"
    },
    {
      "key": "base_url_laboratorios",
      "value": "http://localhost:8082",
      "type": "string"
    }
  ]
}
